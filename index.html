<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Delicioso - Sistema de Gest√£o</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" />
    
    <link href="https://fonts.googleapis.com/css2?family=Farsan&family=Inter:wght@400;600;800&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#FFA20C',
                        secondary: '#E28B00'
                    },
                    fontFamily: {
                        'farsan': ['Farsan', 'cursive'],
                        'inter': ['Inter', 'sans-serif']
                    }
                }
            }
        }
    </script>

    <style>
        body { 
            background-color: #f3f4f6 !important; 
            color: #1f2937 !important;
            min-width: 1280px; 
            overflow-x: auto;
        }

        .app-layout {
            display: flex;
            height: 100vh;
        }

        .sidebar {
            width: 260px;
            min-width: 260px;
            background: linear-gradient(180deg, #FFA20C 0%, #E28B00 100%);
            color: white;
            display: flex;
            flex-direction: column;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
        }

        .sidebar-item { 
            padding: 16px 24px;
            cursor: pointer; 
            display: flex;
            align-items: center;
            transition: all 0.2s;
            font-weight: 600;
        }

        .sidebar-item:hover { background: rgba(255,255,255,0.15); }
        .active-nav { background: rgba(0,0,0,0.1); border-left: 5px solid white; }

        .main-content {
            flex: 1;
            padding: 40px;
            overflow-y: auto;
        }

        .card {
            background: white !important;
            border-radius: 12px;
            padding: 24px;
            border: 1px solid #e5e7eb;
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05);
            margin-bottom: 24px;
        }

        .input-field {
            border: 2px solid #d1d5db;
            padding: 10px 14px;
            border-radius: 8px;
            width: 100%;
            background: white !important;
            color: #1f2937 !important;
            outline: none;
        }

        .input-field:focus { border-color: #FFA20C; }

        table { width: 100%; border-collapse: collapse; background: white; }
        th { background: #f9fafb; padding: 12px; text-align: left; color: #4b5563; font-size: 12px; text-transform: uppercase; border-bottom: 2px solid #f3f4f6; }
        td { padding: 12px; border-bottom: 1px solid #f3f4f6; }

        .tab-content { display: none; }
        .tab-content.active { display: block; animation: fadeIn 0.3s; }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .btn-primary {
            background: #FFA20C;
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 700;
            transition: 0.2s;
            cursor: pointer;
            border: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
        .btn-primary:hover { background: #E28B00; transform: translateY(-1px); }
        
        .login-layout { display: flex; justify-content: center; align-items: center; height: 100vh; background: #f3f4f6; }
    </style>
</head>
<body class="font-inter">

    <div id="login_screen" class="login-layout">
        <div class="card w-[400px]">
            <div class="text-center mb-8">
                <span class="text-6xl">üç≤</span>
                <h1 class="font-farsan text-5xl text-primary mt-2">Delicioso</h1>
                <p class="text-gray-500 text-sm mt-2">Painel Administrativo</p>
            </div>
            <form id="loginForm" onsubmit="event.preventDefault(); handleLogin();">
                <div class="mb-4">
                    <label class="block text-xs font-bold text-gray-600 mb-1 uppercase">Usu√°rio</label>
                    <input type="text" id="username" class="input-field" placeholder="admin">
                </div>
                <div class="mb-6">
                    <label class="block text-xs font-bold text-gray-600 mb-1 uppercase">Senha</label>
                    <input type="password" id="password" class="input-field" placeholder="1234">
                </div>
                <button type="submit" class="btn-primary w-full text-lg">ENTRAR NO SISTEMA</button>
            </form>
        </div>
    </div>

    <div id="app_container" class="app-layout hidden">
        
        <aside class="sidebar">
            <div class="p-10 text-center border-b border-white/20">
                <span class="text-4xl mb-2 block">üç≤</span>
                <h1 class="font-farsan text-4xl">Delicioso</h1>
            </div>
            
            <nav class="flex-grow py-6">
                <div onclick="showTab('dashboard')" class="sidebar-item active-nav" id="nav_dashboard">
                    <i class="fas fa-chart-line w-8"></i> Dashboard
                </div>
                <div onclick="showTab('novo_pedido')" class="sidebar-item" id="nav_novo_pedido">
                    <i class="fas fa-plus-circle w-8"></i> Novo Pedido
                </div>
                <div onclick="showTab('pedidos')" class="sidebar-item" id="nav_pedidos">
                    <i class="fas fa-list w-8"></i> Hist√≥rico
                </div>
                <div onclick="showTab('produtos')" class="sidebar-item" id="nav_produtos">
                    <i class="fas fa-utensils w-8"></i> Produtos
                </div>
                <div onclick="showTab('embalagens')" class="sidebar-item" id="nav_embalagens">
                    <i class="fas fa-box-open w-8"></i> Estoque
                </div>
            </nav>

            <div onclick="handleLogout()" class="sidebar-item bg-black/10 hover:bg-red-600 mt-auto">
                <i class="fas fa-sign-out-alt w-8"></i> Sair do Sistema
            </div>
        </aside>

        <main class="main-content">
            
            <div id="dashboard" class="tab-content active">
                <div class="flex justify-between items-center mb-8">
                    <h2 class="text-3xl font-extrabold text-gray-800">Dashboard</h2>
                    <div class="flex gap-3">
                        <input type="date" id="dash_data_ini" class="input-field w-44">
                        <input type="date" id="dash_data_fim" class="input-field w-44">
                        <button onclick="carregarDashboard()" class="btn-primary">Filtrar</button>
                    </div>
                </div>

                <div class="grid grid-cols-4 gap-6 mb-8">
                    <div class="card border-l-8 border-green-500">
                        <p class="text-gray-400 text-xs font-bold uppercase">Faturamento Total</p>
                        <p class="text-3xl font-black mt-1" id="dash_faturamento">R$ 0,00</p>
                    </div>
                    <div class="card border-l-8 border-red-500">
                        <p class="text-gray-400 text-xs font-bold uppercase">Total Fiado (A Pagar)</p>
                        <p class="text-3xl font-black mt-1 text-red-600" id="dash_apagar">R$ 0,00</p>
                    </div>
                    <div class="card border-l-8 border-orange-400">
                        <p class="text-gray-400 text-xs font-bold uppercase">Frete Motoboy</p>
                        <p class="text-3xl font-black mt-1" id="dash_frete_alto">R$ 0,00</p>
                    </div>
                    <div class="card border-l-8 border-blue-400">
                        <p class="text-gray-400 text-xs font-bold uppercase">Frete Delicioso</p>
                        <p class="text-3xl font-black mt-1" id="dash_frete_baixo">R$ 0,00</p>
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-8">
                    <div class="card">
                        <h3 class="font-bold text-lg mb-6 flex items-center"><i class="fas fa-wallet mr-2 text-primary"></i> M√©todos de Pagamento</h3>
                        <ul id="lista_pagamentos" class="space-y-4"></ul>
                    </div>
                    <div class="card">
                        <h3 class="font-bold text-lg mb-6 flex items-center text-red-600"><i class="fas fa-exclamation-triangle mr-2"></i> Clientes Devedores</h3>
                        <table class="w-full">
                            <thead><tr><th>Pedido</th><th>Cliente</th><th class="text-right">Valor</th></tr></thead>
                            <tbody id="lista_devedores"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div id="novo_pedido" class="tab-content">
                <h2 class="text-3xl font-extrabold mb-8">Novo Pedido</h2>
                <div class="grid grid-cols-3 gap-8">
                    <div class="col-span-2 space-y-6">
                        <div class="card">
                            <h3 class="font-bold mb-4 text-orange-600 border-b pb-2">1. Dados do Cliente</h3>
                            <div class="grid grid-cols-2 gap-4">
                                <input type="text" id="cli_nome" placeholder="Nome do Cliente" class="input-field">
                                <input type="text" id="cli_end" placeholder="Endere√ßo Completo" class="input-field">
                                <input type="number" id="cli_frete" placeholder="Valor do Frete (R$)" class="input-field">
                                <select id="cli_pag" class="input-field">
                                    <option value="Dinheiro">Dinheiro</option>
                                    <option value="Pix">Pix</option>
                                    <option value="Cart√£o">Cart√£o</option>
                                    <option value="A Pagar">A Pagar (Fiado)</option>
                                </select>
                            </div>
                        </div>
                        <div class="card">
                            <h3 class="font-bold mb-4 text-orange-600 border-b pb-2">2. Itens do Pedido</h3>
                            <div class="flex gap-4">
                                <select id="sel_produto" class="input-field flex-grow"></select>
                                <input type="number" id="qtd_produto" value="1" min="1" class="input-field w-24 text-center font-bold">
                                <button onclick="adicionarAoCarrinho()" class="btn-primary w-20 text-xl">+</button>
                            </div>
                        </div>
                    </div>
                    <div class="card flex flex-col h-fit sticky top-10">
                        <h3 class="font-bold text-xl mb-4 text-gray-700">Carrinho</h3>
                        <ul id="lista_carrinho" class="space-y-3 mb-6 flex-grow"></ul>
                        <div class="border-t pt-4 bg-gray-50 -m-6 p-6 rounded-b-lg">
                            <p class="text-4xl font-black text-right text-orange-600" id="total_display">R$ 0,00</p>
                            <button onclick="finalizarPedido()" class="btn-primary w-full py-4 mt-4 text-xl shadow-lg">FINALIZAR PEDIDO</button>
                        </div>
                    </div>
                </div>
            </div>

            <div id="pedidos" class="tab-content">
                <h2 class="text-3xl font-extrabold mb-8">Hist√≥rico de Pedidos</h2>
                <div class="card">
                    <table>
                        <thead><tr><th>ID</th><th>Data/Hora</th><th>Cliente</th><th>Pagamento</th><th class="text-right">Total</th></tr></thead>
                        <tbody id="tabela_historico"></tbody>
                    </table>
                </div>
            </div>

            <div id="produtos" class="tab-content">
                <h2 class="text-3xl font-extrabold mb-8">Gerenciar Itens</h2>
                <div class="card">
                    <h3 class="font-bold mb-4">Cadastrar Novo Produto</h3>
                    <div class="flex gap-4 items-end">
                        <div class="flex-grow">
                            <label class="text-xs font-bold text-gray-500 uppercase">Nome</label>
                            <input type="text" id="prod_nome" class="input-field">
                        </div>
                        <div class="w-40">
                            <label class="text-xs font-bold text-gray-500 uppercase">Pre√ßo (R$)</label>
                            <input type="number" step="0.01" id="prod_preco" class="input-field">
                        </div>
                        <div class="w-60">
                            <label class="text-xs font-bold text-gray-500 uppercase">Vincular Embalagem</label>
                            <select id="prod_emb" class="input-field"></select>
                        </div>
                        <button onclick="salvarProduto()" class="btn-primary px-8">Salvar</button>
                    </div>
                </div>
                <div class="card">
                    <table id="tabela_produtos">
                        <thead><tr><th>Nome</th><th>Pre√ßo</th><th>Embalagem</th></tr></thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>

            <div id="embalagens" class="tab-content">
                <h2 class="text-3xl font-extrabold mb-8">Controle de Estoque</h2>
                <div class="card bg-green-50 border-green-200">
                    <h3 class="font-bold mb-4 text-green-800">Entrada de Material</h3>
                    <div class="flex gap-4">
                        <input type="text" id="emb_nome" placeholder="Nome da Embalagem" class="input-field">
                        <input type="number" id="emb_qtd" placeholder="Qtd. Inicial" class="input-field w-40">
                        <button onclick="salvarEmbalagem()" class="btn-primary bg-green-600 hover:bg-green-700">Cadastrar</button>
                    </div>
                </div>
                <div class="grid grid-cols-4 gap-6" id="grid_embalagens"></div>
            </div>

        </main>
    </div>

    <script>
        // L√≥gica de Scripts id√™ntica √† anterior, mantendo a integra√ß√£o com Render
        let carrinho = [];
        let produtosCache = [];
        const API_BASE = "https://delicioso-34fj.onrender.com";

        async function api(url, method='GET', body=null) {
            const options = { method, headers: { 'Content-Type': 'application/json' } };
            if (body) options.body = JSON.stringify(body);
            try {
                const res = await fetch(`${API_BASE}${url}`, options);
                return await res.json();
            } catch (e) { console.error("Erro na API:", e); }
        }

        function showTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.sidebar-item').forEach(i => i.classList.remove('active-nav'));
            document.getElementById(tabId).classList.add('active');
            document.getElementById(`nav_${tabId}`).classList.add('active-nav');
            if(tabId === 'dashboard') carregarDashboard();
            if(tabId === 'produtos') carregarProdutos();
            if(tabId === 'embalagens') carregarEmbalagens();
            if(tabId === 'novo_pedido') carregarOpcoesProdutos();
            if(tabId === 'pedidos') carregarListaPedidos();
        }

        async function carregarDashboard() {
            const ini = document.getElementById('dash_data_ini').value || new Date().toISOString().split('T')[0];
            const fim = document.getElementById('dash_data_fim').value || new Date().toISOString().split('T')[0];
            const dados = await api(`/api/dashboard?data_inicio=${ini}&data_fim=${fim}`);
            if(!dados) return;
            document.getElementById('dash_faturamento').innerText = `R$ ${dados.faturamento_total.toFixed(2)}`;
            document.getElementById('dash_apagar').innerText = `R$ ${dados.a_pagar_total.toFixed(2)}`;
            document.getElementById('dash_frete_alto').innerText = `R$ ${dados.frete_maior_2.toFixed(2)}`;
            document.getElementById('dash_frete_baixo').innerText = `R$ ${dados.frete_menor_2.toFixed(2)}`;
            const listaPag = document.getElementById('lista_pagamentos');
            listaPag.innerHTML = Object.entries(dados.pagamentos).map(([m, v]) => 
                `<li class="flex justify-between font-bold border-b pb-2"><span>${m}</span><span class="text-primary">R$ ${v.toFixed(2)}</span></li>`
            ).join('');
            const listaDev = document.getElementById('lista_devedores');
            listaDev.innerHTML = dados.devedores.map(d => 
                `<tr><td>#${d.id_pedido}</td><td class="font-bold">${d.nome}</td><td class="text-right text-red-600 font-bold">R$ ${d.valor.toFixed(2)}</td></tr>`
            ).join('');
        }

        async function carregarProdutos() {
            const dados = await api('/api/produtos');
            const embs = await api('/api/embalagens');
            const tbody = document.querySelector('#tabela_produtos tbody');
            tbody.innerHTML = dados.map(p => `<tr><td class="font-bold">${p.nome}</td><td>R$ ${p.preco.toFixed(2)}</td><td class="text-gray-500">${p.nome_embalagem || 'Nenhuma'}</td></tr>`).join('');
            const sel = document.getElementById('prod_emb');
            sel.innerHTML = '<option value="">N√£o descontar estoque</option>' + embs.map(e => `<option value="${e.id}">${e.nome}</option>`).join('');
        }

        async function salvarProduto() {
            const nome = document.getElementById('prod_nome').value;
            const preco = document.getElementById('prod_preco').value;
            const id_embalagem = document.getElementById('prod_emb').value;
            await api('/api/produtos', 'POST', { nome, preco: parseFloat(preco), id_embalagem });
            carregarProdutos();
        }

        async function carregarEmbalagens() {
            const dados = await api('/api/embalagens');
            const grid = document.getElementById('grid_embalagens');
            grid.innerHTML = dados.map(e => `
                <div class="card text-center border-t-4 ${e.quantidade < 10 ? 'border-red-500' : 'border-green-500'}">
                    <p class="font-bold text-gray-700">${e.nome}</p>
                    <p class="text-3xl font-black my-2">${e.quantidade}</p>
                    <div class="flex gap-1">
                        <input type="number" id="edit_${e.id}" class="input-field p-1 text-center" value="${e.quantidade}">
                        <button onclick="atualizarEstoque(${e.id})" class="btn-primary p-2"><i class="fas fa-save"></i></button>
                    </div>
                </div>
            `).join('');
        }

        async function salvarEmbalagem() {
            const nome = document.getElementById('emb_nome').value;
            const quantidade = document.getElementById('emb_qtd').value;
            await api('/api/embalagens', 'POST', { nome, quantidade: parseInt(quantidade) });
            carregarEmbalagens();
        }

        async function atualizarEstoque(id) {
            const qtd = document.getElementById(`edit_${id}`).value;
            await api('/api/embalagens/editar', 'POST', { id, quantidade: parseInt(qtd) });
            carregarEmbalagens();
        }

        async function carregarOpcoesProdutos() {
            produtosCache = await api('/api/produtos');
            const sel = document.getElementById('sel_produto');
            sel.innerHTML = produtosCache.map((p, i) => `<option value="${i}">${p.nome} - R$ ${p.preco.toFixed(2)}</option>`).join('');
        }

        function adicionarAoCarrinho() {
            const idx = document.getElementById('sel_produto').value;
            const qtd = parseInt(document.getElementById('qtd_produto').value);
            const p = produtosCache[idx];
            carrinho.push({ ...p, qtd, subtotal: p.preco * qtd });
            renderCarrinho();
        }

        function renderCarrinho() {
            const lista = document.getElementById('lista_carrinho');
            lista.innerHTML = carrinho.map((item, i) => `
                <li class="flex justify-between bg-white p-2 rounded border">
                    <span><b>${item.qtd}x</b> ${item.nome}</span>
                    <span class="font-bold">R$ ${item.subtotal.toFixed(2)}</span>
                </li>
            `).join('');
            const frete = parseFloat(document.getElementById('cli_frete').value) || 0;
            const total = carrinho.reduce((a, b) => a + b.subtotal, 0) + frete;
            document.getElementById('total_display').innerText = `R$ ${total.toFixed(2)}`;
        }

        async function finalizarPedido() {
            const cliente = {
                nome: document.getElementById('cli_nome').value,
                endereco: document.getElementById('cli_end').value,
                frete: document.getElementById('cli_frete').value,
                pagamento: document.getElementById('cli_pag').value
            };
            if(!cliente.nome) return alert("Informe o cliente");
            const res = await api('/api/pedidos', 'POST', { cliente, carrinho });
            alert(res.message);
            carrinho = [];
            renderCarrinho();
            showTab('dashboard');
        }

        async function carregarListaPedidos() {
            const dados = await api('/api/pedidos');
            const tbody = document.getElementById('tabela_historico');
            tbody.innerHTML = dados.map(p => `
                <tr>
                    <td>#${p.id}</td>
                    <td>${new Date(p.data_hora).toLocaleString()}</td>
                    <td class="font-bold">${p.cliente}</td>
                    <td><span class="bg-gray-100 px-2 py-1 rounded text-xs font-bold">${p.pagamento}</span></td>
                    <td class="text-right font-black text-green-600">R$ ${p.total.toFixed(2)}</td>
                </tr>
            `).join('');
        }

        function handleLogin() {
            if(document.getElementById('username').value === 'admin' && document.getElementById('password').value === '1234') {
                sessionStorage.setItem('isLoggedIn', 'true');
                renderApp();
            } else { alert("Acesso negado."); }
        }

        function renderApp() {
            const logado = sessionStorage.getItem('isLoggedIn') === 'true';
            document.getElementById('login_screen').classList.toggle('hidden', logado);
            document.getElementById('app_container').classList.toggle('hidden', !logado);
            if(logado) showTab('dashboard');
        }

        function handleLogout() { sessionStorage.clear(); location.reload(); }

        window.onload = renderApp;
    </script>
</body>
</html>